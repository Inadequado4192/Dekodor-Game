(()=>{"use strict";var e={485:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AI=t.init=t.setCharacter=t.setMove=t.move=t.OnSkull=t.onSkull=t.character=void 0;const o=n(620),a=n(372),c=n(714),r=n(746),i=n(971);t.character=null,t.onSkull=!0,t.OnSkull=function(e){t.onSkull=e},t.move="U";let s=0;t.setMove=function(e){t.move=e},t.setCharacter=function(e){t.character=e},t.init=function(){t.onSkull=!0,t.move="U",s=0,t.character=null,u=0,l=!1};let u=0,l=!1;t.AI=function e(){if(!t.character||!a.character)return;let n=Date.now(),d={run:0,conspicuous:400};if("SCP-173"==i.mode&&(d={run:100,conspicuous:1/0}),o.conspicuous?l=o.conspicuous:l&&(l=!1,u=n),!t.character||s+(u+1e3<n&&!o.conspicuous?d.run:d.conspicuous)>=n)return;let m,{x:h,y:p}=t.character;if(o.conspicuous){let n=a.character.x-t.character.x,o=a.character.y-t.character.y;const c=e=>e>0?1:0==e?0:-1;let i=[];-1==c(n)?i.push("L"):1==c(n)&&i.push("R"),-1==c(o)?i.push("U"):1==c(o)&&i.push("D"),m=i[Math.floor(Math.random()*i.length)];let s=null;switch(m){case"D":s=r.getObject(h,p+1);break;case"L":s=r.getObject(h-1,p);break;case"R":s=r.getObject(h+1,p);break;case"U":s=r.getObject(h,p-1)}if(!m)return;if("Wall"==s?.name)return e()}else{let e=r.getReverseDirection(t.move),n=c.Direction.filter((t=>{if(t==e)return!1;switch(t){case"D":return"Wall"!=r.getObject(h,p+1)?.name;case"L":return"Wall"!=r.getObject(h-1,p)?.name;case"R":return"Wall"!=r.getObject(h+1,p)?.name;case"U":return"Wall"!=r.getObject(h,p-1)?.name}}));m=n[Math.floor(Math.random()*n.length)],0==n.length&&(m=e)}t.move=m,t.character.pos=r.moveObject(t.character.pos,t.move),s=n}},372:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.playerMove=t.setCharacter=t.updatePlayerLastMove=t.character=t.move=t.lastMove=t.direction=void 0;const o=n(620),a=n(746);class c extends Set{last(){return Array.from(this)[this.size-1]}}function r(){t.lastMove=Date.now()}t.direction="U",t.lastMove=0,t.move=new c,t.character=null,t.updatePlayerLastMove=r,t.setCharacter=function(e){t.character=e},t.playerMove=function(){if(t.character&&t.lastMove+250<Date.now()&&0!==t.move.size){let e=t.move.last();o.shitKet||(t.direction=e),t.character.pos=a.moveObject(t.character.pos,e),r()}},t.init=function(){t.direction="U",t.lastMove=0,t.move.clear(),t.character=null}},459:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SoundDisable=t.SoundEnable=t.MusicDisable=t.MusicEnable=t.GameAudio=void 0;const o=n(971);class a extends Audio{constructor(e,t){super(e),this.playbackRate=t?.speed??1,this.loop=t?.loop??!1,this.volume=t?.volume??1}play(){return this.stop(),super.play()}stop(){super.pause(),this.currentTime=0}}class c extends a{constructor(e,t){super(e,t),this.type="music",this.loop=!0,this.muted=!0}}class r extends a{constructor(e,t){super(e,t),this.type="sound",this.loop=!1}}const i="./src/mp3";t.GameAudio={"Scary-Piano-Glissando":new r(`${i}/Scary-Piano-Glissando.mp3`,{speed:2}),"Anxious-Humming":new c(`${i}/Anxious-Humming.mp3`),Music:new c(`${i}/Music.mp3`,{volume:.5}),Scream:new r(`${i}/Scream.mp3`,{volume:.2}),Scream_p1:new r(`${i}/Scream_p1.mp3`,{volume:.2})},t.MusicEnable=function(){"menu"==o.frame&&t.GameAudio.Music.play();for(let e in t.GameAudio){let n=t.GameAudio[e];"music"==n.type&&(n.muted=!1)}},t.MusicDisable=function(){for(let e in t.GameAudio){let n=t.GameAudio[e];"music"==n.type&&(n.muted=!0)}},t.SoundEnable=function(){for(let e in t.GameAudio){let n=t.GameAudio[e];"sound"==n.type&&(n.muted=!1)}},t.SoundDisable=function(){for(let e in t.GameAudio){let n=t.GameAudio[e];"sound"==n.type&&(n.muted=!0)}},window.GameAudio=t.GameAudio},620:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.win=t.lose=t.conspicuous=t.SkullCountInit=t.SkullCount=t.addSkullCountPick=t.SkullCountPick=t.currentMap=t.currentMapSize=t.exit=t.shitKet=t.openMap=void 0;const o=n(459),a=n(485),c=n(372),r=n(714),i=n(470),s=n(746),u=n(971);t.openMap=async function(e){A.style.display="none",c.init(),a.init(),t.SkullCountPick=0,t.SkullCount=1,t.SkullCountInit=!1,b=!1,t.shitKet=!1;let n=new Image;n.src=URL.createObjectURL(await(await fetch(`./src/maps/${e}.png`)).blob()),n.onload=()=>{let e=document.createElement("canvas"),o=e.getContext("2d");e.width=n.width,e.height=n.height,o.drawImage(n,0,0,n.width,n.height),t.currentMapSize=[n.width,n.height],t.currentMap=o.getImageData(0,0,n.width,n.height).data,m.width=n.width,m.height=n.height,S.imageSmoothingEnabled=!1,document.addEventListener("keydown",(e=>{"ShiftLeft"==e.code&&(t.shitKet=!0),c.character&&r.DirectionKeys.includes(e.code)&&c.move.add(s.getDirection(e.code))})),document.addEventListener("keyup",(e=>{"ShiftLeft"==e.code&&(t.shitKet=!1),r.DirectionKeys.includes(e.code)&&c.move.has(s.getDirection(e.code))&&c.move.delete(s.getDirection(e.code))})),M()}},t.shitKet=!1,t.exit=function(){document.onkeydown=document.onkeyup=null,b=!0,u.show("menu")};const l=document.querySelector("#canvas"),d=document.querySelector("#mask"),m=document.querySelector("#map"),h=l.getContext("2d"),p=d.getContext("2d"),S=m.getContext("2d");function y(){l.width=innerWidth,l.height=innerHeight,h.imageSmoothingEnabled=!1,d.width=innerWidth,d.height=innerHeight,p.imageSmoothingEnabled=!1,S.imageSmoothingEnabled=!1}y(),window.addEventListener("resize",y);const f=new Image;f.src="./sprite.png";let v=1e3/60,g=Date.now(),k=0,b=!1;function M(){if(b)return;let e=Date.now(),n=e-g;n>v&&(g=e-n%v,c.playerMove(),a.AI(),function(){h.clearRect(0,0,l.width,l.height);let e=t.currentMap.slice(0);for(let n=0;n<t.currentMap.length;n+=4){const o=n/4%t.currentMapSize[0],r=Math.floor(n/4/t.currentMapSize[0]),u=i.SIZE/2;let l=!0;c.character&&(Math.abs(c.character.x-o)>3||Math.abs(c.character.y-r)>3)&&(l=!1),h.save(),h.translate(o*i.SIZE+u-I.x,r*i.SIZE+u-I.y);const d=s.getRGBA(n);let m=s.getObject(d);if(l&&h.drawImage(f,1*i.SPRITE_SIZE,0,i.SPRITE_SIZE,i.SPRITE_SIZE,-u,-u,i.SIZE,i.SIZE),null!==m){if(c.character?.pos==n&&(c.character.x=o,c.character.y=r),a.character?.pos==n)switch(a.setCharacter({x:o,y:r,pos:a.character.pos}),a.move){case"D":h.rotate(-180*Math.PI/180);break;case"L":h.rotate(-90*Math.PI/180);break;case"R":h.rotate(90*Math.PI/180)}"Tank-U"==m.name&&null==c.character&&c.setCharacter({pos:n,x:o,y:r}),"Dekodor"==m.name&&null==a.character&&a.setCharacter({pos:n,x:o,y:r}),"Skull"==m.name&&(t.SkullCountInit||((o+r)%5==0?t.SkullCount++:s.setRGBA(n,[0,0,0,1])),h.scale(.4,.4)),l&&h.drawImage(f,m.spritePos*i.SPRITE_SIZE,0,i.SPRITE_SIZE,i.SPRITE_SIZE,-u,-u,i.SIZE,i.SIZE),h.restore(),"Dekodor"==m.name?s.setRGBA(n,a.onSkull?[255,255,0,255]:[0,0,0,0],e):"0,0,0,0"===d.join(",")&&s.setRGBA(n,[255,255,0,255],e)}else h.restore()}let n=new ImageData(e,t.currentMapSize[0],t.currentMapSize[1]);if(S.putImageData(n,0,0),!c.character)return;t.conspicuous=!1,p.save(),p.fillRect(0,0,d.width,d.height),p.translate(-I.x,-I.y),p.globalCompositeOperation="destination-out",p.fillRect(c.character.x*i.SIZE,c.character.y*i.SIZE,i.SIZE,i.SIZE);const r=(e=0,n=0)=>{p.save();let o=c.character;p.translate(o.x*i.SIZE+e*i.SIZE,o.y*i.SIZE+n*i.SIZE),p.fillRect(0,0,i.SIZE,i.SIZE),t.conspicuous||"Dekodor"!=s.getObject(o.x+e,o.y+n)?.name||(t.conspicuous=!0),p.restore()};function m(e,t,n){let{x:o,y:a}=c.character;for(let c=1;c<=2;c++){let i=e.includes("H")?c*t:0,u=e.includes("V")?c*(n??t):0;if("Wall"===s.getObject(o+i,a+u)?.name){r(i,u);break}r(i,u)}}function y(e,t){return"Wall"===s.getObject(c.character.x+e,c.character.y+t)?.name}"default"==u.mode?(m(["V"],-1),m(["V"],1),m(["H"],-1),m(["H"],1),m(["H","V"],-1,-1),m(["H","V"],1,-1),m(["H","V"],-1,1),m(["H","V"],1,1),y(-1,-1)||(r(-1,-2),r(-2,-1)),y(1,-1)||(r(1,-2),r(2,-1)),y(1,1)||(r(1,2),r(2,1)),y(-1,1)||(r(-1,2),r(-2,1))):"SCP-173"==u.mode&&(["U"].includes(c.direction)&&(m(["V"],-1),r(-1,0),r(1,0),!y(-1,-1)&&r(-1,-2),!y(1,-1)&&r(1,-2)),["D"].includes(c.direction)&&(m(["V"],1),r(-1,0),r(1,0),!y(-1,1)&&r(-1,2),!y(1,1)&&r(1,2)),["L"].includes(c.direction)&&(m(["H"],-1),r(0,-1),r(0,1),!y(-1,-1)&&r(-2,-1),!y(-1,1)&&r(-2,1)),["R"].includes(c.direction)&&(m(["H"],1),r(0,-1),r(0,1),!y(1,-1)&&r(2,-1),!y(1,1)&&r(2,1)),["L","U"].includes(c.direction)&&m(["H","V"],-1,-1),["R","U"].includes(c.direction)&&m(["H","V"],1,-1),["L","D"].includes(c.direction)&&m(["H","V"],-1,1),["R","D"].includes(c.direction)&&m(["H","V"],1,1)),w+8e3<Date.now()&&(!E&&t.conspicuous&&(E=!0,o.GameAudio["Scary-Piano-Glissando"].play(),w=Date.now()),t.conspicuous||(E=!1)),p.restore()}(),!t.SkullCountInit&&(t.SkullCountInit=!0),function(){if(!c.character)return;let e={x:0,y:0};e.x=c.character.x*i.SIZE-innerWidth/2+i.SIZE/2,e.y=c.character.y*i.SIZE-innerHeight/2+i.SIZE/2,I.x+=(e.x-I.x)/20,I.y+=(e.y-I.y)/20}(),k++),requestAnimationFrame(M)}t.SkullCountPick=0,t.addSkullCountPick=function(){return++t.SkullCountPick},t.SkullCount=1,t.SkullCountInit=!1,t.conspicuous=!1;let E=!1,w=0,I={x:0,y:0};const A=document.querySelector("#alert"),D=document.querySelector("#alert > h2"),R=document.querySelector("#scream");function x(){o.GameAudio.Scream.play(),o.GameAudio.Scream_p1.play(),R.classList.add("a"),setTimeout((()=>R.classList.remove("a")),500),D.innerHTML="You lose",A.style.display="flex",b=!0}function P(){D.innerHTML="You win",A.style.display="flex",b=!0}t.lose=x,t.win=P,window.getObject=s.getObject,window.lose=x,window.win=P;const L=document.querySelector("#fps");setInterval((()=>{L.innerHTML=`${k} FPS`,k=0}),1e3)},714:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Direction=t.DirectionKeys=void 0,t.DirectionKeys=["KeyW","KeyD","KeyA","KeyS"],t.Direction=["U","R","L","D"]},971:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.show=t.frame=t.mode=void 0;const o=n(459),a=n(620),c=document.querySelector("#start_btn"),r=document.querySelector("#SCP-173_btn"),i=document.querySelector("#tutor_btn"),s=document.querySelector("#restart_btn"),u=document.querySelector("#menu_btn"),l=document.querySelector("#maps"),d=document.querySelector("#mapPreview"),m=document.querySelector("#version"),h=document.querySelector("#music"),p=document.querySelector("#sound");c.addEventListener("click",(()=>{t.mode="default",y("game")})),r.addEventListener("click",(()=>{t.mode="SCP-173",y("game")})),i.addEventListener("click",(()=>{y("tutor")})),s.addEventListener("click",(()=>{a.openMap(f)})),u.addEventListener("click",(()=>{y("menu")})),t.mode="default",t.frame="menu";let S="menu";function y(e){t.frame=e,document.querySelectorAll("body > div").forEach((e=>e.style.display="none")),document.querySelector(`body > div#${e}`).style.display="flex","game"==e?(a.openMap(f),o.GameAudio.Music.stop(),o.GameAudio["Anxious-Humming"].play()):"menu"==e&&(o.GameAudio["Anxious-Humming"].stop(),o.GameAudio.Music.play()),S=e}t.show=y;for(let e=0;e<4;e++)l.insertAdjacentHTML("beforeend",`<span${0==e?' class="active"':""}>${e+1}<span>`);let f=0;document.querySelectorAll("#maps > span").forEach(((e,t)=>{e.onclick=()=>{document.querySelector("#maps > span.active")?.classList.remove("active"),e.classList.add("active"),f=t},e.onmouseover=()=>{d.src=`./src/maps/${t}.png`,d.style.left=`${e.offsetLeft+e.offsetWidth/2}px`,d.style.top=`${e.offsetTop+e.offsetHeight+10}px`},e.onmouseout=()=>{d.src=""}})),fetch("./package.json").then((e=>e.json().then((e=>{m.innerHTML=e.version})))),h.onclick=()=>{h.classList.contains("a")?(h.classList.remove("a"),o.MusicDisable()):(h.classList.add("a"),o.MusicEnable())},p.onclick=()=>{p.classList.contains("a")?(p.classList.remove("a"),o.SoundDisable()):(p.classList.add("a"),o.SoundEnable())},o.SoundEnable(),document.addEventListener("keydown",(e=>{if("Escape"==e.code)return a.exit()}))},746:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getObject=t.setRGBA=t.getRGBA=t.moveObject=t.getDirection=t.getReverseDirection=void 0;const o=n(620),a=n(470),c=n(485),r=n(372);function i(e){return[o.currentMap[e+0],o.currentMap[e+1],o.currentMap[e+2],o.currentMap[e+3]]}function s(e,t,n=o.currentMap){n[e+0]=t[0],n[e+1]=t[1],n[e+2]=t[2],n[e+3]=t[3]}function u(e,t){return Array.isArray(e)?a.list.find((t=>t.RGBA.join(",")==e.join(",")))??null:o.currentMapSize?u(i(4*e+4*t*o.currentMapSize[0])):null}t.getReverseDirection=function(e){switch(e){case"D":return"U";case"L":return"R";case"R":return"L";case"U":return"D"}},t.getDirection=function(e){switch(e){case"KeyW":return"U";case"KeyD":return"R";case"KeyA":return"L";case"KeyS":return"D"}throw Error()},t.moveObject=function(e,t){let n,a=e==r.character?.pos,l=e==c.character?.pos,d=i(e),m=!1,h=c.onSkull;switch(t){case"U":n=4*-o.currentMapSize[0],a&&!o.shitKet&&(d[2]=255);break;case"R":n=4,a&&!o.shitKet&&(d[2]=254);break;case"L":n=-4,a&&!o.shitKet&&(d[2]=253);break;case"D":n=4*o.currentMapSize[0],a&&!o.shitKet&&(d[2]=252)}let p=i(e+n);switch(u(p)?.name){case"Wall":return s(e,d),e;case"Tank-U":case"Tank-R":case"Tank-L":case"Tank-D":if(l)return o.lose(),e;case"Dekodor":if(a)return o.lose(),e;case"Skull":a&&(o.addSkullCountPick()==o.SkullCount&&o.win(),m=!0),l&&!h&&(c.OnSkull(!0),m=!0)}return l&&h&&"0,0,0,1"==p.join(",")?(c.OnSkull(!1),s(e,[0,0,0,0])):s(e,m?[0,0,0,1]:p),s(e+n,d),e+n},t.getRGBA=i,t.setRGBA=s,t.getObject=u},470:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.list=t.SIZE=t.SPRITE_SIZE=void 0,t.SPRITE_SIZE=32,t.SIZE=2*t.SPRITE_SIZE,t.list=[{name:"Wall",RGBA:[0,0,0,255],spritePos:6},{name:"Tank-U",RGBA:[0,0,255,255],spritePos:2},{name:"Tank-R",RGBA:[0,0,254,255],spritePos:3},{name:"Tank-L",RGBA:[0,0,253,255],spritePos:4},{name:"Tank-D",RGBA:[0,0,252,255],spritePos:5},{name:"Dekodor",RGBA:[255,0,0,255],spritePos:0},{name:"Skull",RGBA:[0,0,0,0],spritePos:7}]}},t={};!function n(o){var a=t[o];if(void 0!==a)return a.exports;var c=t[o]={exports:{}};return e[o](c,c.exports,n),c.exports}(971)})();